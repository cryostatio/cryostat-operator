apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  name: container-jfr-operator-bundle.v0.0.2
  namespace: placeholder
  annotations:
    alm-examples: >-
      [{"apiVersion":"","kind":"ContainerJFR","metadata":{"name":""},"spec":{}},{"apiVersion":"","kind":"FlightRecorder","metadata":{"name":""},"spec":{}},{"apiVersion":"","kind":"","metadata":{"name":""},"spec":{}}]
    categories: 'Monitoring, Developer Tools'
    certified: 'false'
    description: JVM monitoring and profiling tool
    containerImage: ''
    support: ''
    capabilities: Basic Install
    repository: ''
spec:
  displayName: ContainerJFR
  description: |
    ## About the managed application
    ## About this Operator
    ## Prerequisites for enabling this Operator
  maturity: pre-alpha
  version: 0.0.2
  replaces: ''
  minKubeVersion: ''
  keywords:
    - java
    - monitoring
    - profiling
    - jfr
    - flightrecorder
  maintainers:
    - name: Andrew Azores
      email: aazores@redhat.com
  provider:
    name: ''
  labels: {}
  selector:
    matchLabels: {}
  links:
    - name: Upstream
      url: 'https://github.com/rh-jmc-team/container-jfr'
  icon:
    - base64data: ''
      mediatype: image/png
  customresourcedefinitions:
    owned:
      - name: containerjfrs.rhjmc.redhat.com
        displayName: ContainerJFR
        kind: ContainerJFR
        version: v1alpha1
        description: Container JFR
        resources:
          - version: v1
            kind: Deployment
          - version: v1
            kind: Service
          - version: v1
            kind: ReplicaSet
          - version: v1
            kind: Pod
          - version: v1
            kind: Secret
          - version: v1
            kind: ConfigMap
        specDescriptors: []
        statusDescriptors: []
      - name: flightrecorders.rhjmc.redhat.com
        displayName: FlightRecorder
        kind: FlightRecorder
        version: v1alpha1
        description: FlightRecorders
        resources:
          - version: v1
            kind: Deployment
          - version: v1
            kind: Service
          - version: v1
            kind: ReplicaSet
          - version: v1
            kind: Pod
          - version: v1
            kind: Secret
          - version: v1
            kind: ConfigMap
        specDescriptors: []
        statusDescriptors: []
    required: []
  install:
    strategy: deployment
    spec:
      # TODO copy in operator_role.yaml permissions rather than duplicating
      permissions:
        - serviceAccountName: container-jfr-operator
          rules:
            - apiGroups:
                - ''
              resources:
                - pods
                - services
                - services/finalizers
                - routes
                - routes.route.openshift.io
                - endpoints
                - persistentvolumeclaims
                - events
                - configmaps
                - secrets
              verbs:
                - '*'
            - apiGroups:
                - 'route.openshift.io'
              resources:
                - routes
              verbs:
                - '*'
            - apiGroups:
                - apps
              resources:
                - deployments
                - daemonsets
                - replicasets
                - statefulsets
              verbs:
                - '*'
            - apiGroups:
                - monitoring.coreos.com
              resources:
                - servicemonitors
              verbs:
                - get
                - create
            - apiGroups:
                - apps
              resourceNames:
                - container-jfr-operator
              resources:
                - deployments/finalizers
              verbs:
                - update
            - apiGroups:
                - ''
              resources:
                - pods
              verbs:
                - get
            - apiGroups:
                - apps
              resources:
                - replicasets
              verbs:
                - get
            - apiGroups:
                - rhjmc.redhat.com
              resources:
                - '*'
              verbs:
                - '*'
      clusterPermissions: []
      deployments:
        - name: container-jfr-operator
          spec:
            replicas: 1
            selector:
              matchLabels:
                name: container-jfr-operator
            template:
              metadata:
                labels:
                  name: container-jfr-operator
              spec:
                serviceAccountName: container-jfr-operator
                containers:
                  - name: container-jfr-operator
                    image: 'quay.io/rh-jmc-team/container-jfr-operator:0.1.2'
                    command:
                      - container-jfr-operator
                    imagePullPolicy: Always
                    env:
                      - name: WATCH_NAMESPACE
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.namespace
                      - name: POD_NAME
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.name
                      - name: OPERATOR_NAME
                        value: container-jfr-operator
  installModes:
    - type: OwnNamespace
      supported: true
    - type: SingleNamespace
      supported: true
    - type: MultiNamespace
      supported: false
    - type: AllNamespaces
      supported: false
